{% extends "admin_base.html" %}
{% load static %}
{% block title %} 
Dashboard
{% endblock %}
{% block style %} 
<link rel="stylesheet" href="{% static "assets/css/main_new.css" %}">
<script>
  {% comment %} .card-title {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 10px;
  }

  .form-container {
    width: 300px;
    margin: 0 auto;
  }

  .form-container select,
  .form-container input[type="date"],
  .form-container button {
    width: 100%;
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
  }

  .form-container button {
    background-color: #4CAF50;
    color: white;
    cursor: pointer;
  }

  .form-container button:hover {
    background-color: #45a049;
  }

  .text-muted {
    color: #777;
  }

  .font-weight-light {
    font-weight: lighter;
  }
  .button-container {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
}

.button_chart {
    padding: 10px 20px;
    margin: 0 10px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.button_chart:hover {
    background-color: #45a049;
} {% endcomment %}

</script>
{% endblock %}
{% block page_name %} 
Dashboard
{% endblock %}
{% block content %} 
<div class="row">
  <div class="col-md-3 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <p class="card-title text-md-center text-xl-left">Users</p>
        <div class="d-flex flex-wrap justify-content-between justify-content-md-center justify-content-xl-between align-items-center">
          <h3 class="mb-0 mb-md-2 mb-xl-0 order-md-1 order-xl-0">{{users}}</h3>
          <i class="ti-calendar icon-md text-muted mb-0 mb-md-3 mb-xl-0"></i>
        </div>  
        <p class="mb-0 mt-2 text-danger">0.12% <span class="text-black ms-1"><small>(30 days)</small></span></p>
      </div>
    </div>
  </div>
  <div class="col-md-3 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <p class="card-title text-md-center text-xl-left">Sales</p>
        <div class="d-flex flex-wrap justify-content-between justify-content-md-center justify-content-xl-between align-items-center">
        <h3 class="mb-0 mb-md-2 mb-xl-0 order-md-1 order-xl-0">{{ord}}</h3>
          <i class="ti-user icon-md text-muted mb-0 mb-md-3 mb-xl-0"></i>
        </div>  
        <p class="mb-0 mt-2 text-danger">0.47% <span class="text-black ms-1"><small>(30 days)</small></span></p>
      </div>
    </div>
  </div>
  <div class="col-md-3 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <p class="card-title text-md-center text-xl-left">Amount</p>
        <div class="d-flex flex-wrap justify-content-between justify-content-md-center justify-content-xl-between align-items-center">
          <h3 class="mb-0 mb-md-2 mb-xl-0 order-md-1 order-xl-0">{{amount}}</h3>
          <i class="ti-agenda icon-md text-muted mb-0 mb-md-3 mb-xl-0"></i>
        </div>  
        <p class="mb-0 mt-2 text-success">64.00%<span class="text-black ms-1"><small>(30 days)</small></span></p>
      </div>
    </div>
  </div>
  <div class="col-md-3 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <p class="card-title text-md-center text-xl-left">Offers</p>
        <div class="d-flex flex-wrap justify-content-between justify-content-md-center justify-content-xl-between align-items-center">
          <h3 class="mb-0 mb-md-2 mb-xl-0 order-md-1 order-xl-0">{{offers}}</h3>
          <i class="ti-layers-alt icon-md text-muted mb-0 mb-md-3 mb-xl-0"></i>
        </div>  
        <p class="mb-0 mt-2 text-success">23.00%<span class="text-black ms-1"><small>(30 days)</small></span></p>
      </div>
    </div>
  </div>
</div>

  <div class="row">
        <div class="col-md-6 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <p class="card-title">Sales details</p>
              <p class="text-muted font-weight-light">Received overcame oh sensible so at an. Formed do change merely to county it. Am separate contempt domestic to to oh. On relation my so addition branched.</p>
              <div id="sales-legend" class="chartjs-legend mt-4 mb-2"></div>
              <!-- <canvas id="sales-chart"></canvas> -->
              <div class="btn-group d-flex justify-content-center" role="group" aria-label="Chart Options">
                <br>
                <button type="button" class="btn btn-primary" onclick="showYearlyChart()">Yearly</button>
                <button type="button" class="btn btn-primary " onclick="showMonthlyChart()">Monthly</button>
                <button type="button" class="btn btn-primary" onclick="showLast30DaysChart()">Last 30 Days</button>
            </div>
            
            <div class="mt-4">
              <canvas id="myChart_year" style="display: none;"></canvas>
                <canvas id="myChart_month"></canvas>
                <canvas id="myChart_last_30_days" style="display: none;"></canvas>
            </div>
            
            
              
            
            </div>
          </div>
        </div>
      
        <div class="col-md-6 grid-margin stretch-card">
          <div class="card border-bottom-0">
            <div class="card-body">
              <div class="row">
                  <div class="col-md- ml-xl-4">
                    <p class="card-title">Payment details</p>
                      <p class="text-muted mb-2 mb-xl-0 ">The total number of sessions within the date range. It is the period time a user is actively engaged with your website, page, or app, etc.</p>
                      <h3 class="font-weight-light mb-xl-4  text-center">Sales</h3>
                      <h1 class=" text-center">{{sale}}</h1>
                  </div>
                  <div class="col-md-9 d-flex justify-content-center " style="margin-left: 70px;">
                      <canvas id="north-america-chart"></canvas>
                      <div id="north-america-legend"></div>
                  </div>
                  
              </div>
          
          </div>
        </div>
  </div>
</div>
      
<div class="row">
  <div class="col-md-6 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <p class="card-title mb-0">Top Products</p>
        <div class="table-responsive">
          <table class="table">
            <thead class="thead-dark">
              <tr>
                <th scope="col">Product Image</th>
                <th scope="col">Product Name</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity</th>
              </tr>
            </thead>
            <tbody>
              {% for product in top_products %}
              <tr>
                <td><img src="{{ product.prodect_image1.url }}" alt="{{ product.name }}" width="100"></td>
                <td>{{ product.prodect_name }}</td>
                <td>${{ product.price }}</td>
                <td>{{ product.quantity }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <p class="card-title mb-0">Top Category</p>
        <div class="table-responsive">
          <table class="table">
            <thead class="thead-dark">
              <tr>
                <th scope="col">Product Image</th>
                <th scope="col">Product Name</th>
                {% comment %} <th scope="col">Price</th>
                <th scope="col">Quantity</th> {% endcomment %}
              </tr>
            </thead>
            <tbody>
              {% for  product in top_products %}
            <tr>
               <td><img  src="{{product.category.category_image.url}}" alt="{{ product.category.category_image }}" width="100"></td>
               <td>{{ product.category.name }}</td>
            </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>


{% comment %} <div class="row">
  <div class="col-md-7 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <p class="card-title mb-0">Top Products</p>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>User</th>
                <th>Product</th>
                <th>Sale</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Jacob</td>
                <td>Photoshop</td>
                <td class="text-danger"> 28.76% <i class="ti-arrow-down"></i></td>
                <td><label class="badge badge-danger">Pending</label></td>
            </tr>
            
              <tr>
                <td>Messsy</td>
                <td>Flash</td>
                <td class="text-danger"> 21.06% <i class="ti-arrow-down"></i></td>
                <td><label class="badge badge-warning">In progress</label></td>
              </tr>
              <tr>
                <td>John</td>
                <td>Premier</td>
                <td class="text-danger"> 35.00% <i class="ti-arrow-down"></i></td>
                <td><label class="badge badge-info">Fixed</label></td>
              </tr>
              <tr>
                <td>Peter</td>
                <td>After effects</td>
                <td class="text-success"> 82.00% <i class="ti-arrow-up"></i></td>
                <td><label class="badge badge-success">Completed</label></td>
              </tr>
              <tr>
                <td>Dave</td>
                <td>53275535</td>
                <td class="text-success"> 98.05% <i class="ti-arrow-up"></i></td>
                <td><label class="badge badge-warning">In progress</label></td>
              </tr>
              <tr>
                <td>Messsy</td>
                <td>Flash</td>
                <td class="text-danger"> 21.06% <i class="ti-arrow-down"></i></td>
                <td><label class="badge badge-info">Fixed</label></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-5 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <h4 class="card-title">To Do Lists</h4>
        <div class="list-wrapper pt-2">
          <ul class="d-flex flex-column-reverse todo-list todo-list-custom">
            <li>
              <div class="form-check form-check-flat">
                <label class="form-check-label">
                  <input class="checkbox" type="checkbox">
                  Become A Travel Pro In One Easy Lesson
                </label>
              </div>
              <i class="remove ti-trash"></i>
            </li>
            <li class="completed">
              <div class="form-check form-check-flat">
                <label class="form-check-label">
                  <input class="checkbox" type="checkbox" checked>
                  See The Unmatched Beauty Of The Great Lakes
                </label>
              </div>
              <i class="remove ti-trash"></i>
            </li>
            <li>
              <div class="form-check form-check-flat">
                <label class="form-check-label">
                  <input class="checkbox" type="checkbox">
                  Copper Canyon
                </label>
              </div>
              <i class="remove ti-trash"></i>
            </li>
            <li class="completed">
              <div class="form-check form-check-flat">
                <label class="form-check-label">
                  <input class="checkbox" type="checkbox" checked>
                  Top Things To See During A Holiday In Hong Kong
                </label>
              </div>
              <i class="remove ti-trash"></i>
            </li>
            <li>
              <div class="form-check form-check-flat">
                <label class="form-check-label">
                  <input class="checkbox" type="checkbox">
                  Travelagent India
                </label>
              </div>
              <i class="remove ti-trash"></i>
            </li>
          </ul>
        </div>
        <div class="add-items d-flex mb-0 mt-4">
          <input type="text" class="form-control todo-list-input me-2"  placeholder="Add new task">
          <button class="add btn btn-icon text-primary todo-list-add-btn bg-transparent"><i class="ti-location-arrow"></i></button>
        </div>
      </div>
    </div>
  </div>
</div> {% endcomment %}



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  var monthlyChart = document.getElementById('myChart_month');
  var yearlyChart = document.getElementById('myChart_year');
  var last30DaysChart = document.getElementById('myChart_last_30_days');

  // Function to show monthly chart
  function showMonthlyChart() {
      monthlyChart.style.display = 'block';
      yearlyChart.style.display = 'none';
      last30DaysChart.style.display = 'none';
      myChart_month.update();
  }

  // Function to show yearly chart
  function showYearlyChart() {
      monthlyChart.style.display = 'none';
      yearlyChart.style.display = 'block';
      last30DaysChart.style.display = 'none';
      myChart_year.update();
  }

  // Function to show last 30 days chart
  function showLast30DaysChart() {
      monthlyChart.style.display = 'none';
      yearlyChart.style.display = 'none';
      last30DaysChart.style.display = 'block';
      myChart_last_30_days.update();
  }

  // Monthly Chart
  var ctx_month = document.getElementById('myChart_month').getContext('2d');
  var myChart_month = new Chart(ctx_month, {
      type: 'bar',
      data: {
          labels: {{ months|safe }},
          datasets: [{
              label: 'Monthly Orders',
              data: {{ order_counts|safe }},
              backgroundColor: 'rgba(54, 162, 235, 0.5)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
          }]
      },
      options: {
          scales: {
              y: {
                  beginAtZero: true
              }
          }
      }
  });

  // Yearly Chart
  var ctx_year = document.getElementById('myChart_year').getContext('2d');
  var myChart_year = new Chart(ctx_year, {
      type: 'bar',
      data: {
          labels: {{ years|safe }},
          datasets: [{
              label: 'Yearly Orders',
              data: {{ yearly_order_counts|safe }},
              backgroundColor: 'rgba(255, 99, 132, 0.5)',
              borderColor: 'rgba(255, 99, 132, 1)',
              borderWidth: 1
          }]
      },
      options: {
          scales: {
              y: {
                  beginAtZero: true
              }
          }
      }
  });

 // Last 30 Days Chart
 var ctx_last_30_days = document.getElementById('myChart_last_30_days').getContext('2d');
 var last30DaysDataKeys = Object.keys({{ last_30_days_data|safe }});
 var last30DaysDataValues = Object.values({{ last_30_days_data|safe }});

 var myChart_last_30_days = new Chart(ctx_last_30_days, {
     type: 'bar',
     data: {
         labels: last30DaysDataKeys,
         datasets: [{
             label: 'Orders in Last 30 Days',
             data: last30DaysDataValues,
             backgroundColor: 'rgba(75, 192, 192, 0.5)',
             borderColor: 'rgba(75, 192, 192, 1)',
             borderWidth: 1
         }]
     },
     options: {
         scales: {
             y: {
                 beginAtZero: true
             }
         }
     }
 });
 var onlineData = {{ online|safe }};
 var offlineData = {{ offline|safe }};
 var walletData = {{ wallet|safe }};
 var months = {{ months|safe }};
 var order_counts = {{ order_counts|safe }};
 console.log(onlineData,offlineData,walletData)
</script>




{% comment %} <script>
  var ctx = document.getElementById('myChart').getContext('2d');
  var myChart
  document.addEventListener('load', ()=>{
    fetchSalesData('yearly');
  })
    function fetchSalesData(timeframe) {
      $.ajax({
        url: `sales_chart_data/${timeframe}`,
        method: 'GET'
      })
      .then(data => {
        renderChart(data)
      })
      .catch(err => {
        console.log('Error :', err);
      })
    }

    function renderChart(data) {
        myChart.destory();
        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Sales',
                    data: data.data,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
</script> {% endcomment %}


{% endblock %}



          

